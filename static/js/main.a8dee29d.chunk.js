(this["webpackJsonpreact-poker"]=this["webpackJsonpreact-poker"]||[]).push([[0],{183:function(e,t,a){e.exports={main:"LoginPage_main__1-3jE"}},184:function(e,t,a){},189:function(e,t,a){e.exports=a(322)},209:function(e,t){},211:function(e,t){},252:function(e,t){},253:function(e,t){},304:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=304},321:function(e,t,a){},322:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(178),i=a.n(o),c=a(16);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var l=a(18),s=a(49),m=a(37),u=a.n(m),d=a(45);function p(){var e=Object(d.a)(["\n  mutation($input: MakeMoveInput!) {\n    makeMove(input: $input) {\n      success\n    }\n  }\n"]);return p=function(){return e},e}function f(){var e=Object(d.a)(["\n  subscription($roomId: ID!) {\n    getRoom(roomId: $roomId) {\n      moveTimeLimit\n      currentGame {\n        version\n        currentPlayer {\n          ...FullPlayer\n        }\n        currentStage\n        isFinished\n        smallBlind\n        bigBlind\n        pot\n        boardCards {\n          rank\n          color\n        }\n        players {\n          ...FullPlayer\n        }\n      }\n      users {\n        id\n        name\n      }\n    }\n  }\n\n  ","\n"]);return f=function(){return e},e}function g(){var e=Object(d.a)(["\n  fragment FullPlayer on Player {\n    id\n    name\n    active\n    isInTurn\n    avatarUrl\n    balance\n    moneyInPot\n    position\n    seatNumber\n    cards {\n      rank\n      color\n    }\n  }\n"]);return g=function(){return e},e}function b(){var e=Object(d.a)(["\n  query GetRooms {\n    rooms {\n      id\n      name\n    }\n  }\n"]);return b=function(){return e},e}function h(){var e=Object(d.a)(["\n  query GetCurrentUser {\n    currentUser {\n      id\n      name\n    }\n  }\n"]);return h=function(){return e},e}function _(){var e=Object(d.a)(["\n  mutation($username: String!, $password: String!) {\n    signinUser(input: { username: $username, password: $password }) {\n      token\n    }\n  }\n"]);return _=function(){return e},e}var v=Object(c.gql)(_()),E=Object(c.gql)(h()),P=Object(c.gql)(b()),O=Object(c.gql)(g()),R=Object(c.gql)(f(),O),j=Object(c.gql)(p()),y=function(){var e=Object(c.useQuery)(P),t=e.data,a=(t=void 0===t?{}:t).rooms,n=e.loading,o=e.error;if(o)throw new Error(o);return n?r.a.createElement("div",null,"Loading..."):r.a.createElement("div",null,r.a.createElement("ul",null,a.map((function(e){return r.a.createElement("li",{key:e.id},r.a.createElement(s.b,{to:"rooms/".concat(e.id)}," Room /",e.name,"/ "))}))))},k=a(30),C=a(87),w=a(66),N=Object(n.createContext)(),I=r.a.memo((function(e){var t=e.chatId,a=e.users,o=e.fixedPosition,i=void 0===o?"bottomLeft":o,c=Object(n.useRef)(null),l=function(e){var t=e.chatId,a=e.users,r=e.conversationSettings,o=(r=void 0===r?{}:r).photoUrl,i=r.subject,c=Object(n.useContext)(N),l=c.session,s=c.currentChatUser,m=c.loading;return console.log(l,s,m),Object(n.useMemo)((function(){if(m)return null;var e=a.map((function(e){return new w.a.User(e)})),n=l.getOrCreateConversation(t);return[s].concat(Object(C.a)(e)).forEach((function(e){return n.setParticipant(e)})),n.setAttributes({photoUrl:o||"https://demo.talkjs.com/img/11.jpg",subject:i||"Beautiful Steel Preserve for rent!"}),l.createChatbox(n)}),[a,m,l,s])}({chatId:t,users:a});Object(n.useEffect)((function(){return l&&c?(l.mount(c.current),function(){l.destroy()}):function(){}}),[l,c.current]);var s={bottomLeft:{position:"fixed",bottom:"0",left:"0",height:"400px"}}[i];return r.a.createElement("div",{style:s,ref:c})}),(function(e,t){var a=e.chatId,n=e.users,r=e.fixedPosition,o=t.chatId,i=t.users,c=t.fixedPosition;return o===a&&c===r&&JSON.stringify(i)===JSON.stringify(n)})),x=function(e){var t=e.children,a=e.currentUser,o=e.appId,i=Object(n.useState)(null),c=Object(k.a)(i,2),l=c[0],s=c[1],m=Object(n.useState)(null),u=Object(k.a)(m,2),d=u[0],p=u[1];return Object(n.useEffect)((function(){a&&w.a.ready.then((function(){var e=new w.a.User(a);s(e),p(new w.a.Session({appId:o,me:e}))}))}),[a,o]),r.a.createElement(N.Provider,{value:{session:d,currentChatUser:l,loading:!d}},t)},B=a(51),q=a.n(B),L=u.a.bind(q.a),S=function(e){var t=e.minRaiseAmount,a=e.makeMove,o=Object(n.useState)(t),i=Object(k.a)(o,2),c=i[0],l=i[1],s=Object(n.useCallback)((function(e){l(parseInt(e.target.value,10))}),[]);return r.a.createElement("div",{className:L("turn-menu")},r.a.createElement("div",{className:L("raise-amount-row")},r.a.createElement("input",{value:c,size:"5",onChange:s}),r.a.createElement("input",{type:"range",id:"raise-range",name:"raise-range",value:c,onChange:s,min:t,max:"1000"})),r.a.createElement("div",{className:L("buttons-row")},r.a.createElement("button",{type:"button",className:L("fold"),onClick:function(e){return a({move:"fold"})}},"Fold"),r.a.createElement("button",{type:"button",className:L("call"),onClick:function(e){return a({move:"call"})}},"Call"),r.a.createElement("button",{type:"button",className:L("raise"),onClick:function(){return a({move:"raise",bet:c})}},"Raise ",c)))},U=a(64),T=function(e){var t=e.rank,a=e.color;if("hidden"===t)return"back";return"".concat(a,"_").concat({A:"1",J:"jack",Q:"queen",K:"king"}[t]||t)},A=function(e){return"/re-poker/".concat(e)},M=a(13),J=a.n(M),$={color:J.a.string,rank:J.a.string.isRequired},F=J.a.shape({id:J.a.string.isRequired,name:J.a.string.isRequired,seatNumber:J.a.number.isRequired,active:J.a.bool.isRequired,isInTurn:J.a.bool.isRequired,cards:J.a.arrayOf($),position:J.a.string.isRequired,balance:J.a.number.isRequired,moneyInPot:J.a.number.isRequired}),D=(J.a.shape({pot:J.a.number.isRequired,smallBlind:J.a.number.isRequired,bigBlind:J.a.number.isRequired,currentPlayer:F,players:J.a.arrayOf(F),boardCards:J.a.arrayOf($)}),u.a.bind(q.a)),G={0:{dealerClass:"dealer-bottom-right",chipsClass:"chips-bottom-right",seatClass:"bottom-right",infoBoxPosition:"left"},1:{dealerClass:"dealer-middle-right",chipsClass:"chips-middle-right",seatClass:"middle-right",infoBoxPosition:"center"},2:{dealerClass:"dealer-top-right",chipsClass:"chips-top-right",seatClass:"top-right",infoBoxPosition:"right"},3:{dealerClass:"dealer-top-left",chipsClass:"chips-top-left",seatClass:"top-left",infoBoxPosition:"right"},4:{dealerClass:"dealer-middle-left",chipsClass:"chips-middle-left",seatClass:"middle-left",infoBoxPosition:"center"},5:{dealerClass:"dealer-bottom-left",chipsClass:"chips-bottom-left",seatClass:"bottom-left",infoBoxPosition:"left"}};function z(e){var t=e.smallBlind,a=e.betAmount,n=e.classes,o=10*t,i=t,c=parseInt(a/o,10),l=parseInt((a-c*o)/i,10);return r.a.createElement("div",{className:D(["chips-container"].concat(Object(C.a)(n)))},r.a.createElement("div",{className:D("chip-column")},!!c&&Array.from({length:c},(function(){return r.a.createElement("img",{src:A("/chips/chip-black.png"),alt:"blue-chip",className:D("chip")})}))),r.a.createElement("div",{className:D("chip-column")},!!l&&Array.from({length:l},(function(){return r.a.createElement("img",{src:A("/chips/chip-blue.png"),alt:"blue-chip",className:D("chip")})}))))}var Q=function(e){var t,a=e.player,o=e.smallBlind,i=e.moveTimeLimit,c=Object(n.useState)(i),l=Object(k.a)(c,2),s=l[0],m=l[1],u=a.cards[0],d=a.cards[1];Object(n.useEffect)((function(){if(!a.isInTurn)return m(i),function(){};if(s<=0)return function(){};var e=setTimeout((function(){m(s-.5)}),500);return function(){clearTimeout(e)}}),[a.isInTurn,s]);var p=G[a.seatNumber],f=p.seatClass,g=p.infoBoxPosition,b=p.dealerClass,h=p.chipsClass,_=D({"time-bar":!0,red:s<3}),v=D((t={seat:!0},Object(U.a)(t,f,!0),Object(U.a)(t,"inactive",!a.active),t));return r.a.createElement("div",{key:a.id},"D"===a.position&&r.a.createElement("img",{src:A("/chips/chip-dealer.png"),alt:"dealer-chip",className:D("dealer-chip",b)}),r.a.createElement(z,{classes:[h],smallBlind:o,betAmount:a.moneyInPot}),r.a.createElement("div",{className:v},r.a.createElement("div",{className:D("avatar")}," ",r.a.createElement("img",{src:A("avatars/business-man-avatar.png"),alt:"business-man-avatar"})," "),r.a.createElement("div",{className:D("info-box",g)},r.a.createElement("span",null,a.name),r.a.createElement("span",null,"$",a.balance),r.a.createElement("div",{className:D("cards-wrapper")},r.a.createElement("img",{src:A("cards/".concat(T(u),".png")),alt:T(u),className:D({card:!0,raised:!!u})}),r.a.createElement("img",{src:A("cards/".concat(T(d),".png")),alt:T(u),className:D({kcard:!0,raised:!!d})})),a.isInTurn?r.a.createElement("progress",{value:2*s,max:2*i,className:_}):null)))},V=u.a.bind(q.a);function Z(e){var t=e.game,a=e.moveTimeLimit;return console.log(t),r.a.createElement("div",{className:V("table")},r.a.createElement("div",null,r.a.createElement("p",null,"Pot: $",t.pot),r.a.createElement("p",null,"Small blind: $",t.smallBlind),r.a.createElement("p",null,"Big blind: $",t.bigBlind),r.a.createElement("p",null,"Player in turn: ",t.players.find((function(e){return e.isInTurn})).id)),t.players.map((function(e){var n;return(null===t||void 0===t||null===(n=t.currentPlayer)||void 0===n?void 0:n.id)===e.id?r.a.createElement(Q,{key:e.seatNumber,player:t.currentPlayer,smallBlind:t.smallBlind}):r.a.createElement(Q,{key:e.seatNumber,player:e,smallBlind:t.smallBlind,moveTimeLimit:a})})),r.a.createElement("div",{className:V("common-cards")},t.boardCards.map(T).map((function(e){return r.a.createElement("img",{className:V("card"),src:A("re-poker/cards/".concat(e,".png")),alt:e})}))))}var Y=function(){var e,t=Object(l.h)().roomId,a=Object(c.useSubscription)(R,{variables:{roomId:t}}),n=a.data,o=(n=void 0===n?{}:n).getRoom,i=a.loading,s=a.error,m=Object(c.useMutation)(j),u=Object(k.a)(m,1)[0],d=function(e){var t=e.move,a=e.bet,n=e.xPlayerId;u({variables:{input:{gameVersion:o.currentGame.version,move:t,bet:a,xPlayerId:n}}})};if(window.makeMove=d,s)throw new Error(s);if(i)return console.log("Loading..."),"Loading...";var p=o.currentGame,f=o.moveTimeLimit,g=o.users;return r.a.createElement("div",{className:V("room")},r.a.createElement(Z,{game:p,moveTimeLimit:f}),r.a.createElement("div",{className:V("footer")},r.a.createElement(I,{users:g,chatId:"poker-".concat(t),fixedPosition:"bottomLeft"}),r.a.createElement("div",null),(null===(e=p.currentPlayer)||void 0===e?void 0:e.isInTurn)&&r.a.createElement(S,{minRaiseAmount:200,makeMove:d})))},H=a(111),W=a.n(H),X=a(182),K=a(183),ee=a.n(K),te=u.a.bind(ee.a),ae=function(e){var t=e.onSuccessLogin,a=e.isAuthenticated,o=Object(c.useMutation)(v),i=Object(k.a)(o,1)[0],s=Object(n.useState)(""),m=Object(k.a)(s,2),u=m[0],d=m[1],p=Object(n.useState)(""),f=Object(k.a)(p,2),g=f[0],b=f[1],h=function(){var e=Object(X.a)(W.a.mark((function e(a){var n,r,o,c,l;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),e.next=3,i({variables:{username:u,password:g}});case 3:if(n=e.sent,r=n.data,o=(r=void 0===r?{}:r).signinUser,c=(o=void 0===o?{}:o).token,!(l=n.error)){e.next=12;break}return console.error(l),e.abrupt("return");case 12:t(c);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return a?r.a.createElement(l.a,{to:"/"}):r.a.createElement("div",{className:te("main")},r.a.createElement("form",{onSubmit:h},r.a.createElement("input",{type:"text",placeholder:"username",value:u,onChange:function(e){d(e.target.value)}}),r.a.createElement("input",{type:"password",placeholder:"password",value:g,onChange:function(e){b(e.target.value)}}),r.a.createElement("button",{type:"submit"}," Login ")))},ne=a(184),re=a.n(ne),oe=u.a.bind(re.a),ie=function(){var e=Object(l.g)().pathname;return Object(n.useEffect)((function(){window.scrollTo(0,0)}),[e]),null},ce=function(){var e=Object(c.useQuery)(E),t=e.data,a=(t=void 0===t?{}:t).currentUser,o=e.refetch,i=!!a,m=function(e){localStorage.setItem("token",e),o()};return r.a.createElement(x,{currentUser:a,appId:"tp5ifGlr"},r.a.createElement("div",{className:oe("main")},r.a.createElement(s.a,{basename:"/re-poker"},r.a.createElement(ie,null),r.a.createElement(n.Suspense,{fallback:r.a.createElement("div",null,"Loading...")},r.a.createElement(l.d,null,r.a.createElement(l.b,{exact:!0,path:"/login",render:function(e){return r.a.createElement(ae,Object.assign({onSuccessLogin:m,isAuthenticated:i},e))}}),r.a.createElement(l.b,{path:"/",exact:!0,render:function(e){return i?r.a.createElement(y,e):r.a.createElement(l.a,{to:"/login"})}}),r.a.createElement(l.b,{path:"/rooms/:roomId",exact:!0,render:function(e){return i?r.a.createElement(Y,e):r.a.createElement(l.a,{to:"/login"})}}))))))},le=a(185),se=a(186),me=a.n(se),ue=a(187),de=a(188),pe=Object(c.createHttpLink)({uri:"https://http://ec2-54-170-156-213.eu-west-1.compute.amazonaws.com:3001/graphql"}),fe=Object(de.a)((function(e,t){var a=t.headers,n=localStorage.getItem("token");return{headers:Object(le.a)({},a,{authorization:n?"Bearer ".concat(n):""})}})),ge=fe.concat(pe),be=localStorage.getItem("token"),he=me.a.createConsumer("wss://http://ec2-54-170-156-213.eu-west-1.compute.amazonaws.com:3001/cable"),_e=fe.concat(new ue.ActionCableLink({cable:he,connectionParams:{token:be}})),ve=c.ApolloLink.split((function(e){return e.query.definitions.some((function(e){var t=e.kind,a=e.operation;return"OperationDefinition"===t&&"subscription"===a}))}),_e,ge),Ee=new c.ApolloClient({link:ve,cache:new c.InMemoryCache});a(321);i.a.render(r.a.createElement(c.ApolloProvider,{client:Ee},r.a.createElement(ce,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},51:function(e,t,a){e.exports={room:"RoomPage_room__31QOV",table:"RoomPage_table__3G9fA","dealer-chip":"RoomPage_dealer-chip__oUxPd","dealer-top-right":"RoomPage_dealer-top-right__3x5oI","dealer-top-left":"RoomPage_dealer-top-left__3d6of","dealer-middle-right":"RoomPage_dealer-middle-right__1LDVE","dealer-middle-left":"RoomPage_dealer-middle-left__2zM80","dealer-bottom-right":"RoomPage_dealer-bottom-right__3NCZm","dealer-bottom-left":"RoomPage_dealer-bottom-left__2GY36","chips-container":"RoomPage_chips-container__ye1MQ","chip-column":"RoomPage_chip-column__3QP8B",chip:"RoomPage_chip__3tF38","chips-top-right":"RoomPage_chips-top-right__7q9rL","chips-top-left":"RoomPage_chips-top-left__1JlA2","chips-middle-right":"RoomPage_chips-middle-right__36UZE","chips-middle-left":"RoomPage_chips-middle-left__1NPiL","chips-bottom-right":"RoomPage_chips-bottom-right__2eB1v","chips-bottom-left":"RoomPage_chips-bottom-left__JIjfe","common-cards":"RoomPage_common-cards__3MJJv",card:"RoomPage_card__3z3yr",seat:"RoomPage_seat__2nDCN",inactive:"RoomPage_inactive__30FxZ","info-box":"RoomPage_info-box__aeFyN","cards-wrapper":"RoomPage_cards-wrapper__wU4bP","top-right":"RoomPage_top-right__EJzfm","top-left":"RoomPage_top-left__2lONB","middle-right":"RoomPage_middle-right__2505e","middle-left":"RoomPage_middle-left__1FsQh","bottom-right":"RoomPage_bottom-right__3Fn77","bottom-left":"RoomPage_bottom-left__1XbLa",avatar:"RoomPage_avatar__3JHpS","time-bar":"RoomPage_time-bar__2qpv8","animate-stripes":"RoomPage_animate-stripes__3gSYV",red:"RoomPage_red__kEhWf",pulse:"RoomPage_pulse__1_oju",raised:"RoomPage_raised__3VY_H",center:"RoomPage_center__1DlZo",left:"RoomPage_left__COpqe",right:"RoomPage_right__3bBty",footer:"RoomPage_footer__1RpJG","turn-menu":"RoomPage_turn-menu__JX3sC","raise-amount-row":"RoomPage_raise-amount-row__3kl_F","buttons-row":"RoomPage_buttons-row__ZlY1o"}}},[[189,1,2]]]);
//# sourceMappingURL=main.a8dee29d.chunk.js.map